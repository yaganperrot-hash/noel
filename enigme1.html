<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="system-config" content="part_1: OJdYazz"> 
  <title>Énigme 1 – Le Sapin Mystérieux</title>
  <style>
    body {
        margin: 0; padding: 0; height: 100vh; width: 100vw;
        background-image: url('fondecran.png'); 
        background-size: cover; background-position: center; background-repeat: no-repeat;
        font-family: sans-serif;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
    }

    input { padding: 10px; border: 1px solid #ccc; border-radius: 5px; width: 70%; }
    button { padding: 10px 20px; background: #d32f2f; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-left: 80px;}
    button:hover { background: #b71c1c; }
  </style>
</head>
<body data-info="Bienvenue dans cette première énigme. Pour réussir, inspectez.">

  <div class="card">
    <div id="interface">
        <input id="codeInput" placeholder="">
        <button onclick="verif()">Valider</button>
        <p id="msg" style="margin-top:15px; font-weight:bold; min-height: 20px;"></p>
    </div>
    <div id="rewardZone"></div>
  </div>

  <script>

    if(!localStorage.getItem('sys_part_2')) {
        localStorage.setItem('sys_2', 'moi toi soi lui elle nous vous ... elles'); 
    }


    const DebugSystem = {
        version: "1.0",
        status: "OK",

        memory_dump: {
            stack: "empty",
            part_3 :"le mot de passe c'est du classique pour la saison" //
        }
    };
    console.log("Système initialisé. Tapez 'DebugSystem' pour voir l'état de la mémoire.");


    async function sha256(message) {
        const msgBuffer = new TextEncoder().encode(message);
        const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function verif() {
        const input = document.getElementById('codeInput').value.trim().toUpperCase();
        const msg = document.getElementById('msg');
        
       
        const target = "4d67364b097561f63056029d20c7490288f344e78a63588df88f161879008902";
        
        const hash = await sha256(input);

        if (hash === target) {
            msg.style.color = "green";
            msg.innerText = "Accès autorisé.";
            document.getElementById('interface').style.display = 'none';
            revealForm(input);
        } else {
            msg.style.color = "red";
            msg.innerText = "Code incorrect.";
        }
    }

    function revealForm(code) {
        const zone = document.getElementById('rewardZone');
        zone.innerHTML = `
            <h3 style="color:green">Victoire !</h3>
            <p>Saisis ton email :</p>
            <iframe name="hidden_iframe" style="display:none;"></iframe>
            <form action="https://docs.google.com/forms/d/e/1FAIpQLScLkeozfaHugoF57Y5C3bo_vjTFB_YnI6MdBb2bd-ffulfAdg/formResponse" 
                  method="post" target="hidden_iframe" onsubmit="finalShow()">
                <input type="text" name="entry.1719582037" placeholder="email@ecole.com" required style="width:80%">
                <input type="hidden" name="entry.1505677994" value="${code}">
                <br><br>
                <button type="submit" style="background:#2e7d32; width:100%">Envoyer</button>
            </form>
            <div id="final" style="display:none; margin-top:15px; border: 2px dashed #333; padding:10px;">
                Fragment 1 : <strong>FRAGMENT_1</strong>
            </div>
        `;
    }

    function finalShow() {
        setTimeout(() => {
            document.querySelector('form').style.display = 'none';
            document.getElementById('final').style.display = 'block';
        }, 500);
    }
  </script>
</body>
</html>